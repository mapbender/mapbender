var _g=typeof window!=="undefined"?window:global;_g.$JOII={REVISION:23,PublicAPI:{Class:function(e,t){if(!t){t=e;e={}}return new _g.$JOII.ClassBuilder(e,t)},Interface:function(e,t){if(!t){t=e;e={}}return new _g.$JOII.InterfaceBuilder(e,t)},Service:function(e,t,n){if(typeof _g.$JOII.Services[e]!=="undefined"){throw new Error('Another service with the name "'+e+'" is already defined.')}_g.$JOII.Services[e]={object:t,instance:undefined,arguments:n}},RegisterJOIIPlugin:function(e,t){_g.$JOII.Plugins[e]={compile:t.compile||function(){},supports:t.supports||function(){return true},scope:t.scope||{}}}},PublicClassAPI:{"super":function(e){var t=Array.prototype.slice.call(arguments,1),n=this,r=this.__joii__,i=function(e,t,s){if(typeof e==="undefined"){throw new Error('Parent method "'+t+'" does not exist.')}if(typeof e.__joii__.parent!=="undefined"&&typeof e.__joii__.parent.prototype[t]==="undefined"){return i(e.__joii__.parent,t,s)}if(typeof e.__joii__.parent==="undefined"){throw new Error('Method "'+t+'" does not exist.')}var o=e.__joii__.parent.prototype[t];n.__joii__=e.__joii__.parent.prototype.__joii__;var u=o.apply(n,s);n.__joii__=r;return u};return i(this,e,t)},instanceOf:function(e){if(typeof e.__joii__!=="undefined"){e=e.__joii__.clean_prototype}if(typeof e.__interface__!=="undefined"){return _g.$JOII.Compat.indexOf(this.__joii__.interfaces,e.__interface__)!==-1}var t=function(e,n){var r=e;if(typeof e.__joii__!=="undefined"){e=e.__joii__.clean_prototype}if(e===n){return true}if(typeof r.__joii__!=="undefined"){if(typeof r.__joii__.parent!=="undefined"){return t(r.__joii__.parent,n)}}return r===n};return t(this,e)},getService:function(e){return _g.$JOII.System.getService(e)}},Plugins:{},Interfaces:{},Services:{},Namespace:{},RegisterInNS:function(e,t){_g.$JOII.Namespace[e]=t},InterfaceBuilder:function(e,t){var n={};var r=_g.$JOII.System.guid()();for(var i in t){if(!t.hasOwnProperty(i)){continue}if(typeof t[i]!=="string"){throw new Error("An interface definition must be a string, defining the property type.")}n[i]=t[i]}_g.$JOII.Compat.CreateProperty(n,"__interface__",r);_g.$JOII.Interfaces[r]=n;if(typeof e["extends"]==="object"&&!!e["extends"].__interface__){n=_g.$JOII.System.ExtendInterface(n,e["extends"])}return n},ClassBuilder:function(e,t){if(typeof t!=="object"){throw new Error("Class body must be an Object, "+typeof t+"given")}var n=_g.$JOII.System.ApplyPrototype(function(){var e=function(){},r=null;var i=_g.$JOII.Compat.extend(true,{},Object.create(this));e.prototype=i;n=Object.create(new e);_g.$JOII.Compat.CreateProperty(n,"__joii__",this.__joii__);for(r in _g.$JOII.PublicClassAPI){if(typeof n.i!=="undefined"){throw new Error('Method "'+r+'" is reserved by JOII.')}_g.$JOII.Compat.CreateProperty(n,r,_g.$JOII.PublicClassAPI[r])}_g.$JOII.System.ApplyPlugins(n,t);if(typeof n.__construct==="function"){var s=n.__construct.apply(n,arguments);if(typeof s==="object"){e={};for(r in s){if(typeof s[r]==="function"){e[r]=s[r].bind(n)}else{e[r]=s[r]}}_g.$JOII.Compat.CreateProperty(e,"__joii__",this.__joii__);_g.$JOII.Compat.CreateProperty(e,t,_g.$JOII.PublicClassAPI[r]);_g.$JOII.System.ApplyPlugins(e,t);if(typeof n.__joii__.interfaces!=="undefined"&&this.__joii__.interfaces.length>0){for(r in n.__joii__.interfaces){if(typeof n.__joii__.interfaces[r]==="undefined"){continue}var o=_g.$JOII.Interfaces[n.__joii__.interfaces[r]];for(var u in o){if(o.hasOwnProperty(u)&&typeof e[u]!==o[u]){throw new Error("Public API must implement "+o[u]+' "'+u+'" as defined in the interface the class implements.')}}}}return e}}for(var a in n.__joii__.implementation_list){var f=n.__joii__.implementation_list[a];if(typeof n[a]!==f&&a.charAt(0)!=="_"&&a.charAt(1)!=="_"&&typeof f==="string"){if(typeof n[a]==="undefined"){throw new Error("Class is missing "+f+' implementation of property "'+a+'".')}else{throw new Error('Property "'+a+'" must be of type "'+f+'", '+typeof a+" detected.")}}}return n},t);if(typeof e["extends"]==="function"&&typeof e["extends"].prototype==="object"){n=_g.$JOII.System.ApplyParent(n,e["extends"])}else if(typeof e["extends"]==="object"){n=_g.$JOII.System.ApplyTrait(n,e["extends"])}else if(typeof e["extends"]!=="undefined"){throw new Error("Parent class must be a function containing a prototype.")}if(typeof e.uses!=="undefined"){if(typeof e.uses[0]==="undefined"){i=e.uses;e.uses=[i]}for(i in e.uses){if(typeof e.uses[i]==="object"){for(var r in e.uses[i]){var s=e.uses[i][r];if(typeof n.prototype[r]==="undefined"){n.prototype[r]=s}}}}}if(typeof e["implements"]!=="undefined"&&typeof e["implements"][0]==="undefined"){i=e["implements"];e["implements"]=[];e["implements"].push(i)}e["implements"]=e["implements"]||[];n.__joii__["implements"]=e["implements"];n.__joii__["interfaces"]=[];_g.$JOII.System.ApplyInterfaces(n);n.__joii__.clean_prototype=t;_g.$JOII.Compat.CreateProperty(n.prototype,"__joii__",n.__joii__);return n},System:{getService:function(e){if(typeof _g.$JOII.Services[e]==="undefined"){throw new Error('Service "'+e+'" is not defined.')}if(typeof _g.$JOII.Services[e].instance==="undefined"){var t=_g.$JOII.Services[e].object;var n=t.prototype.__construct;var r=[];var i=function(t,n){var r=[];r[e]=function(){return t.apply(this,n)};r[e].prototype=t.prototype;return new r[e]};if(typeof n!=="undefined"){var s=function(e){var t=e.toString().replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,"");var n=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(/([^\s,]+)/g);if(n===null)n=[];return n}(n);var o=_g.$JOII.Services[e].arguments;for(var u in s){var a=o[s[u]];if(typeof a==="string"&&a.charAt(0)==="@"){a=_g.$JOII.System.getService(a.substring(1,a.length))}r.push(a)}}_g.$JOII.Services[e].instance=i(t,r)}return _g.$JOII.Services[e].instance},ApplyPrototype:function(e,t){_g.$JOII.Compat.CreateProperty(e,"__joii__",{});for(var n in t){e.prototype[n]=t[n]}return e},ApplyParent:function(e,t){e.__joii__.parent={};e.__joii__.parent.prototype=t.prototype;if(typeof t.__joii__==="object"){e.__joii__.parent.__joii__=t.__joii__}for(var n in t.prototype){if(typeof e.prototype[n]==="undefined"){e.prototype[n]=t.prototype[n]}}return e},ApplyTrait:function(e,t){if(typeof Object.getOwnPropertyNames!=="undefined"){var n=Object.getOwnPropertyNames(t);for(var r in n){if(typeof e.prototype[n[r]]==="undefined"){e.prototype[n[r]]=Math[n[r]]}}}else{for(var i in t){if(typeof e.prototype[i]==="undefined"){e.prototype[i]=t[i]}}}return e},ApplyPlugins:function(e,t){tmp_product=_g.$JOII.Compat.extend(true,{},e);tmp_product.prototype=tmp_product;for(var n in _g.$JOII.Plugins){if(!_g.$JOII.Plugins[n].supports(tmp_product)){continue}e.prototype=e;if(undefined!==(p=_g.$JOII.Plugins[n].compile(e))){if(typeof p.prototype!=="undefined"){p=p.prototype}e=p}if(typeof e.prototype!=="undefined"){delete e.prototype}for(var r in _g.$JOII.Plugins[n].scope){if(typeof e[r]!=="undefined"){if(typeof t[r]!=="undefined"){throw new Error('Method "'+r+'" is reserved by plugin "'+n+'".')}for(var i in _g.$JOII.Plugins){for(var s in _g.$JOII.Plugins[i].scope){if(s===r&&n!==i){throw new Error('Method "'+r+'" from plugin "'+n+'" is already in use by plugin "'+i+'".')}}}}e[r]=_g.$JOII.Plugins[n].scope[r]}}},ApplyInterfaces:function(e){var t=function(n,r){r=r||{};for(var i in n.__joii__["implements"]){e.__joii__["interfaces"].push(n.__joii__["implements"][i].__interface__);for(var s in n.__joii__["implements"][i]){r[s]=n.__joii__["implements"][i][s]}}if(typeof n.__joii__.parent!=="undefined"){var o=t(n.__joii__.parent,r);for(i in o){r[i]=o[i]}}return r};e.__joii__.implementation_list=t(e)},ExtendInterface:function(e,t){var n=e.__interface__;for(var r in t){if(!t.hasOwnProperty(r)){continue}if(e.hasOwnProperty(r)){continue}e[r]=t[r]}_g.$JOII.Interfaces[n]=e;return e},guid:function(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}},Compat:{isArray:function(e){var t=e.length,n=typeof e;if(n==="function"||typeof window!=="undefined"&&e===window){return false}if(e.nodeType===1&&t){return true}return Object.prototype.toString.call(e)==="[object Array]"},extend:function(){var e,t,n,r=false,i,s=arguments[0]||{},o=1,u=arguments.length,a=false;if(typeof s==="boolean"){a=s;s=arguments[o]||{};o++}if(typeof s!=="object"&&typeof s!=="function"){s={}}for(;o<u;o++){if((e=arguments[o])!==null&&arguments[o]!==undefined){for(var f in e){t=s[f];n=e[f];if(s===n){continue}if(a&&n&&(_g.$JOII.Compat.isPlainObject(n)||(r=_g.$JOII.Compat.isArray(n)))){if(r){r=false;i=t&&_g.$JOII.Compat.isArray(t)?t:[]}else{i=t&&_g.$JOII.Compat.isPlainObject(t)?t:{}}s[f]=_g.$JOII.Compat.extend(a,i,n)}else if(n!==undefined){s[f]=n}}}}return s},isPlainObject:function(e){var t={}.hasOwnProperty;if(typeof e!=="object"||e.nodeType||typeof window!=="undefined"&&e===window){return false}if(e.constructor&&!t.call(e.constructor.prototype,"isPrototypeOf")){return false}return true},indexOf:function(e,t){for(var n in e){if(e[n]===t){return n}}return-1},CreateNamespaceObject:function(e,t){var n=window||global,r=e.split("."),i;while(r.length>0){i=r.shift();if(typeof n[i]==="undefined"){n[i]={}}if(typeof t!=="undefined"&&r.length===0){n[i]=t;return n}n=n[i]}return n},CreateProperty:function(e,t,n){try{if(typeof Object.defineProperty!=="undefined"){Object.defineProperty(e,t,{writable:true,enumerable:false,value:n})}else{e[t]=n}}catch(r){e[t]=n}}},initialize:function(){var e;if(typeof window==="undefined"&&typeof module!=="undefined"){module.exports=_g.$JOII.PublicAPI;e=_g}else{var t=document.getElementsByTagName("script"),n=t[t.length-1];if(!(e=n.getAttribute("data-ns"))){e=_g}if(typeof e==="string"){e=_g.$JOII.Compat.CreateNamespaceObject(e)}}for(var r in _g.$JOII.PublicAPI){if(_g.$JOII.PublicAPI.hasOwnProperty(r)){e[r]=_g.$JOII.PublicAPI[r]}}_g.$JOII.Namespace=e}};if(typeof Object.create==="undefined"){Object.create=function(){function e(){}return function(t){if(arguments.length!=1){throw new Error("Object.create implementation only accepts one parameter.")}e.prototype=t;return new e}}()}if(!Function.prototype.bind){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};r.prototype=this.prototype;i.prototype=new r;return i}}_g.$JOII.initialize()
