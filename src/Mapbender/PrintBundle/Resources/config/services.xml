<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <parameters>
        <parameter key="mapbender.print_service_bridge.service.class">Mapbender\PrintBundle\Component\Service\PrintServiceBridge</parameter>
        <parameter key="mapbender.print_plugin_host.service.class">Mapbender\PrintBundle\Component\Service\PrintPluginHost</parameter>
        <parameter key="mapbender.print.plugin.digitizer.class">Mapbender\PrintBundle\Component\Plugin\DigitizerPrintPlugin</parameter>
        <parameter key="mapbender.print.plugin.digitizer.paramkey.featuretypes">featuretypes</parameter>
        <parameter key="mapbender.print.plugin.queue.class">Mapbender\PrintBundle\Component\Plugin\PrintQueuePlugin</parameter>
        <!-- can only be activated safely if there is a cron job executing the queued jobs -->
        <parameter key="mapbender.print.queueable">false</parameter>
        <!-- Storage path can be anywhere, should probably be /var/ in proper LSB setups
             Storage in web is pre-standardization legacy behavior -->
        <parameter key="mapbender.print.queue.storage_dir">%kernel.root_dir%/../web/prints</parameter>
        <!-- Memory limit for execution of queued jobs. Supports any format understood by php.ini
             see http://php.net/manual/en/ini.core.php#ini.memory-limit
             see http://php.net/manual/en/faq.using.php#faq.using.shorthandbytes
             NOTE: this will never REDUCE memory limit vs a system configuration (php.ini etc), it only works upwards -->
        <parameter key="mapbender.print.queue.memory_limit">1G</parameter>
        <parameter key="mapbender.form_type.element.printclient.class">Mapbender\PrintBundle\Element\Type\PrintClientAdminType</parameter>
    </parameters>
    <services>
        <service id="mapbender.print_service_bridge.service" class="%mapbender.print_service_bridge.service.class%">
            <argument type="service" id="service_container" />
            <argument type="service" id="mapbender.print_plugin_host.service" />
        </service>
        <service id="mapbender.print_plugin_host.service" class="%mapbender.print_plugin_host.service.class%">
            <argument type="service" id="service_container" />
        </service>
        <service id="mapbender.print.plugin.digitizer" class="%mapbender.print.plugin.digitizer.class%">
            <argument type="service" id="service_container" />
            <!-- NOTE: AddBasePrintPluginsPass needs to inspect this argument and can only identify it by its key
                       'featureTypeParam'. That key must be retained. The value may be changed of course. -->
            <argument key="featureTypeParamName">%mapbender.print.plugin.digitizer.paramkey.featuretypes%</argument>
        </service>
        <service id="mapbender.print.plugin.queue" class="%mapbender.print.plugin.queue.class%">
            <argument type="service" id="doctrine.orm.default_entity_manager" />
            <argument type="service" id="security.token_storage" />
            <argument type="service" id="router" />
            <argument key="storagePath">%mapbender.print.queue.storage_dir%</argument>
        </service>
        <service id="mapbender.form_type.element.printclient" class="%mapbender.form_type.element.printclient.class%">
            <argument key="queuable">%mapbender.print.queueable%</argument>
        </service>
    </services>
</container>
